{{ $rel := .Release }}
{{- if .Values.backup.scheduledBackups.enabled }}
{{- range .Values.backup.scheduledBackups.schedules }}
---
apiVersion: postgresql.cnpg.io/v1
kind: ScheduledBackup
metadata:
  name: {{ $rel.Name }}-scheduled-backup
spec:
  schedule: {{ .cronSchedule | quote }}
  backupOwnerReference: {{ .backupOwnerReference | default "cluster" }}
  immediate: {{ ternary "true" "false" (default true .immediateBackup) }}
  method: {{ .method | default "barmanObjectStore" }}
  target: {{ .target | default "primary" }}
  cluster:
    name: cluster-{{ $rel.Name }}
{{- end }}
{{- end }}
